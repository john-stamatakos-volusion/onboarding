'use strict';

var prismic = require('./prismic');
var algolia = require('./algolia');
var prismicTransforms = require('./prismicTransforms');

////////////////////////////////////////////////////
//Get all the prismic documents
module.exports = function (config, cb) {

  prismic.getJSON(config, function(response) {

    ////////////////////////////////////////////////////
    //render the HTML attributes, don't like the structured text complexity
    prismicTransforms.renderAllHtml(response.results);
    prismicTransforms.makeObjectDotNotationFriendly(response.results);

    ////////////////////////////////////////////////////
    //Send them to Algolia
    algolia.sync(config, response.results, cb);

  });

};
